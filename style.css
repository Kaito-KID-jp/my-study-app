/* ==================================================================== */
/* AI問題生成学習アプリ - スタイルシート V3.2.1 (指摘修正・機能移動対応) */
/* ==================================================================== */

/* --- Root Variables & Base Styles --- */
/* ... (変更なし) ... */
:root {
    /* ------------------------- */
    /*    Color Palette          */
    /* ------------------------- */
    /* Base Hues (Adjust these for different color schemes) */
    --primary-hue: 210;
    --secondary-hue: 215;
    --accent-hue: 45; /* Yellowish for accent */
    --success-hue: 134;
    --warning-hue: 40;
    --danger-hue: 0;
    --info-hue: 188;

    /* Light Theme Colors */
    --primary-color-light: hsl(var(--primary-hue), 79%, 60%); /* Brighter Blue */
    --primary-dark-light: hsl(var(--primary-hue), 70%, 50%);
    --primary-light-light: hsl(var(--primary-hue), 90%, 95%); /* Very light blue for backgrounds */
    --secondary-color-light: hsl(var(--secondary-hue), 20%, 50%); /* Muted Gray/Blue */
    --secondary-dark-light: hsl(var(--secondary-hue), 25%, 35%);
    --accent-color-light: hsl(var(--accent-hue), 100%, 50%);
    --success-color-light: hsl(var(--success-hue), 57%, 53%);
    --success-dark-light: hsl(var(--success-hue), 57%, 43%);
    --warning-color-light: hsl(var(--warning-hue), 100%, 50%);
    --warning-dark-light: hsl(var(--warning-hue), 100%, 40%);
    --danger-color-light: hsl(var(--danger-hue), 84%, 60%);
    --danger-dark-light: hsl(var(--danger-hue), 84%, 50%);
    --info-color-light: hsl(var(--info-hue), 75%, 45%);
    --white-color: #ffffff;
    --black-color: #1a1a1a; /* Softer black */

    /* Backgrounds (Light) */
    --bg-base-light: hsl(var(--secondary-hue), 30%, 97%); /* Off-white, slightly cool */
    --bg-card-light: var(--white-color);
    --bg-card-secondary-light: hsl(var(--secondary-hue), 25%, 94%);
    --bg-input-light: var(--white-color);
    --bg-hover-light: hsl(var(--primary-hue), 90%, 92%);
    --bg-active-light: hsl(var(--primary-hue), 90%, 88%);
    --bg-disabled-light: hsl(var(--secondary-hue), 20%, 90%);

    /* Text (Light) */
    --text-dark-light: hsl(var(--secondary-hue), 30%, 15%); /* Dark Gray/Blue */
    --text-light-light: hsl(var(--secondary-hue), 20%, 45%); /* Medium Gray */
    --text-disabled-light: hsl(var(--secondary-hue), 15%, 65%);
    --text-on-primary-light: var(--white-color);
    --text-on-secondary-light: var(--white-color);
    --text-on-accent-light: var(--black-color);
    --text-on-danger-light: var(--white-color);
    --text-on-success-light: var(--white-color);
    --text-on-warning-light: var(--black-color);
    --text-placeholder-light: hsl(var(--secondary-hue), 15%, 65%);

    /* Borders & Shadows (Light) */
    --border-color-light: hsl(var(--secondary-hue), 25%, 85%);
    --border-focus-light: var(--primary-color-light);
    --shadow-color-light: hsla(var(--secondary-hue), 30%, 50%, 0.1);
    --shadow-hover-color-light: hsla(var(--secondary-hue), 30%, 50%, 0.15);
    --shadow-active-color-light: hsla(var(--secondary-hue), 30%, 50%, 0.08);
    --shadow-focus-ring-light: hsla(var(--primary-hue), 79%, 60%, 0.25);
    --inner-shadow-light: hsla(0, 0%, 0%, 0.03);

    /* Evaluation Button Colors (Light) */
    --eval-difficult-bg-light: hsl(var(--danger-hue), 100%, 95%);
    --eval-difficult-text-light: hsl(var(--danger-hue), 70%, 50%);
    --eval-normal-bg-light: hsl(var(--warning-hue), 100%, 95%);
    --eval-normal-text-light: hsl(var(--warning-hue), 80%, 45%);
    --eval-easy-bg-light: hsl(var(--success-hue), 80%, 95%);
    --eval-easy-text-light: hsl(var(--success-hue), 50%, 45%);

    /* Dark Theme Variables */
    --primary-color-dark: hsl(var(--primary-hue), 70%, 65%);
    --primary-dark-dark: hsl(var(--primary-hue), 60%, 55%);
    --primary-light-dark: hsl(var(--primary-hue), 25%, 25%);
    --secondary-color-dark: hsl(var(--secondary-hue), 15%, 55%);
    --secondary-dark-dark: hsl(var(--secondary-hue), 15%, 40%);
    --accent-color-dark: hsl(var(--accent-hue), 100%, 60%);
    --success-color-dark: hsl(var(--success-hue), 50%, 60%);
    --success-dark-dark: hsl(var(--success-hue), 50%, 50%);
    --warning-color-dark: hsl(var(--warning-hue), 100%, 60%);
    --warning-dark-dark: hsl(var(--warning-hue), 100%, 50%);
    --danger-color-dark: hsl(var(--danger-hue), 70%, 65%);
    --danger-dark-dark: hsl(var(--danger-hue), 70%, 55%);
    --info-color-dark: hsl(var(--info-hue), 60%, 55%);

    /* Backgrounds (Dark) */
    --bg-base-dark: hsl(var(--secondary-hue), 15%, 12%); /* Very Dark Gray/Blue */
    --bg-card-dark: hsl(var(--secondary-hue), 15%, 18%);
    --bg-card-secondary-dark: hsl(var(--secondary-hue), 15%, 22%);
    --bg-input-dark: hsl(var(--secondary-hue), 15%, 20%);
    --bg-hover-dark: hsl(var(--primary-hue), 20%, 28%);
    --bg-active-dark: hsl(var(--primary-hue), 20%, 32%);
    --bg-disabled-dark: hsl(var(--secondary-hue), 10%, 25%);

    /* Text (Dark) */
    --text-dark-dark: hsl(var(--secondary-hue), 15%, 90%);
    --text-light-dark: hsl(var(--secondary-hue), 10%, 65%);
    --text-disabled-dark: hsl(var(--secondary-hue), 10%, 45%);
    --text-on-primary-dark: var(--black-color);
    --text-on-secondary-dark: var(--text-dark-dark);
    --text-on-accent-dark: var(--black-color);
    --text-on-danger-dark: var(--white-color);
    --text-on-success-dark: var(--black-color);
    --text-on-warning-dark: var(--black-color);
    --text-placeholder-dark: hsl(var(--secondary-hue), 10%, 45%);

    /* Borders & Shadows (Dark) */
    --border-color-dark: hsl(var(--secondary-hue), 15%, 28%);
    --border-focus-dark: var(--primary-color-dark);
    --shadow-color-dark: hsla(0, 0%, 0%, 0.15);
    --shadow-hover-color-dark: hsla(0, 0%, 0%, 0.2);
    --shadow-active-color-dark: hsla(0, 0%, 0%, 0.1);
    --shadow-focus-ring-dark: hsla(var(--primary-hue), 70%, 65%, 0.3);
    --inner-shadow-dark: hsla(0, 0%, 0%, 0.1);

     /* Evaluation Button Colors (Dark) */
    --eval-difficult-bg-dark: hsla(var(--danger-hue), 50%, 30%, 0.7);
    --eval-difficult-text-dark: hsl(var(--danger-hue), 80%, 80%);
    --eval-normal-bg-dark: hsla(var(--warning-hue), 60%, 30%, 0.7);
    --eval-normal-text-dark: hsl(var(--warning-hue), 90%, 80%);
    --eval-easy-bg-dark: hsla(var(--success-hue), 40%, 30%, 0.7);
    --eval-easy-text-dark: hsl(var(--success-hue), 60%, 80%);

    /* ------------------------- */
    /*     Derived Variables     */
    /* ------------------------- */
    --primary-color: var(--primary-color-light);
    --primary-dark: var(--primary-dark-light);
    --primary-light: var(--primary-light-light);
    --secondary-color: var(--secondary-color-light);
    --secondary-dark: var(--secondary-dark-light);
    --accent-color: var(--accent-color-light);
    --success-color: var(--success-color-light);
    --success-dark: var(--success-dark-light);
    --warning-color: var(--warning-color-light);
    --warning-dark: var(--warning-dark-light);
    --danger-color: var(--danger-color-light);
    --danger-dark: var(--danger-dark-light);
    --info-color: var(--info-color-light);

    --bg-base: var(--bg-base-light);
    --bg-card: var(--bg-card-light);
    --bg-card-secondary: var(--bg-card-secondary-light);
    --bg-input: var(--bg-input-light);
    --bg-hover: var(--bg-hover-light);
    --bg-active: var(--bg-active-light);
    --bg-disabled: var(--bg-disabled-light);

    --text-dark: var(--text-dark-light);
    --text-light: var(--text-light-light);
    --text-disabled: var(--text-disabled-light);
    --text-on-primary: var(--text-on-primary-light);
    --text-on-secondary: var(--text-on-secondary-light);
    --text-on-accent: var(--text-on-accent-light);
    --text-on-danger: var(--text-on-danger-light);
    --text-on-success: var(--text-on-success-light);
    --text-on-warning: var(--text-on-warning-light);
    --text-placeholder: var(--text-placeholder-light);
    --link-color: var(--primary-color-light);
    --link-hover-color: var(--primary-dark-light);

    --border-color: var(--border-color-light);
    --border-focus: var(--border-focus-light);
    --shadow-color: var(--shadow-color-light);
    --shadow-hover-color: var(--shadow-hover-color-light);
    --shadow-active-color: var(--shadow-active-color-light);
    --shadow-focus-ring: var(--shadow-focus-ring-light);
    --inner-shadow: var(--inner-shadow-light);

    --eval-difficult-bg: var(--eval-difficult-bg-light);
    --eval-difficult-text: var(--eval-difficult-text-light);
    --eval-normal-bg: var(--eval-normal-bg-light);
    --eval-normal-text: var(--eval-normal-text-light);
    --eval-easy-bg: var(--eval-easy-bg-light);
    --eval-easy-text: var(--eval-easy-text-light);


    /* ------------------------- */
    /*       Typography          */
    /* ------------------------- */
    --font-family-sans: 'Inter', 'Noto Sans JP', system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
    --font-family-code: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace;
    --font-size-root: 16px; /* Base for rem units */
    --font-size-base: 1rem; /* 16px */
    --font-size-sm: 0.875rem; /* 14px */
    --font-size-lg: 1.125rem; /* 18px */
    --line-height-base: 1.65;
    --line-height-heading: 1.3;
    --font-weight-normal: 400;
    --font-weight-medium: 500;
    --font-weight-semibold: 600;
    --font-weight-bold: 700;

    /* ------------------------- */
    /*     Layout & Effects      */
    /* ------------------------- */
    --border-radius-sm: 4px;
    --border-radius: 8px; /* Slightly larger default */
    --border-radius-lg: 12px;
    --transition-duration: 0.25s;
    --transition-timing: cubic-bezier(0.4, 0, 0.2, 1); /* Smoother easing */
    --spacing-unit: 1rem; /* 16px */
    --spacing-xxs: calc(var(--spacing-unit) * 0.25); /* 4px */
    --spacing-xs: calc(var(--spacing-unit) * 0.5);   /* 8px */
    --spacing-sm: calc(var(--spacing-unit) * 0.75);  /* 12px */
    --spacing-md: var(--spacing-unit);               /* 16px */
    --spacing-lg: calc(var(--spacing-unit) * 1.5);   /* 24px */
    --spacing-xl: calc(var(--spacing-unit) * 2);     /* 32px */
    --spacing-xxl: calc(var(--spacing-unit) * 3);    /* 48px */

    --box-shadow-xs: 0 1px 2px 0 var(--shadow-color);
    --box-shadow-sm: 0 2px 4px -1px var(--shadow-color);
    --box-shadow: 0 4px 8px -2px var(--shadow-color);
    --box-shadow-lg: 0 10px 15px -3px var(--shadow-color), 0 4px 6px -4px var(--shadow-color);
    --box-shadow-xl: 0 20px 25px -5px var(--shadow-color), 0 8px 10px -6px var(--shadow-color);
    --box-shadow-focus: 0 0 0 3px var(--shadow-focus-ring);

    --max-content-width: 1280px;
    --header-height: 64px;
    --bottom-nav-height: 60px; /* Slightly smaller */

    /* Z-index Map */
    --z-index-tooltip: 1100;
    --z-index-modal: 1050;
    --z-index-modal-overlay: 1040;
    --z-index-notification: 1030;
    --z-index-loading-overlay: 2000;
    --z-index-header: 1000; /* Higher z-index for header */
    --z-index-bottom-nav: 1000; /* Higher z-index for bottom nav */
    --z-index-study-eval-panel: 990;
    --z-index-dropdown: 101;
}

/* Dark Theme Overrides */
.theme-dark {
    --primary-color: var(--primary-color-dark);
    --primary-dark: var(--primary-dark-dark);
    --primary-light: var(--primary-light-dark);
    --secondary-color: var(--secondary-color-dark);
    --secondary-dark: var(--secondary-dark-dark);
    --accent-color: var(--accent-color-dark);
    --success-color: var(--success-color-dark);
    --success-dark: var(--success-dark-dark);
    --warning-color: var(--warning-color-dark);
    --warning-dark: var(--warning-dark-dark);
    --danger-color: var(--danger-color-dark);
    --danger-dark: var(--danger-dark-dark);
    --info-color: var(--info-color-dark);

    --bg-base: var(--bg-base-dark);
    --bg-card: var(--bg-card-dark);
    --bg-card-secondary: var(--bg-card-secondary-dark);
    --bg-input: var(--bg-input-dark);
    --bg-hover: var(--bg-hover-dark);
    --bg-active: var(--bg-active-dark);
    --bg-disabled: var(--bg-disabled-dark);

    --text-dark: var(--text-dark-dark);
    --text-light: var(--text-light-dark);
    --text-disabled: var(--text-disabled-dark);
    --text-on-primary: var(--text-on-primary-dark);
    --text-on-secondary: var(--text-on-secondary-dark);
    --text-on-accent: var(--text-on-accent-dark);
    --text-on-danger: var(--text-on-danger-dark);
    --text-on-success: var(--text-on-success-dark);
    --text-on-warning: var(--text-on-warning-dark);
    --text-placeholder: var(--text-placeholder-dark);
    --link-color: var(--primary-color-dark);
    --link-hover-color: hsl(var(--primary-hue), 70%, 75%);

    --border-color: var(--border-color-dark);
    --border-focus: var(--border-focus-dark);
    --shadow-color: var(--shadow-color-dark);
    --shadow-hover-color: var(--shadow-hover-color-dark);
    --shadow-active-color: var(--shadow-active-color-dark);
    --shadow-focus-ring: var(--shadow-focus-ring-dark);
    --inner-shadow: var(--inner-shadow-dark);

    --eval-difficult-bg: var(--eval-difficult-bg-dark);
    --eval-difficult-text: var(--eval-difficult-text-dark);
    --eval-normal-bg: var(--eval-normal-bg-dark);
    --eval-normal-text: var(--eval-normal-text-dark);
    --eval-easy-bg: var(--eval-easy-bg-dark);
    --eval-easy-text: var(--eval-easy-text-dark);

    color-scheme: dark;
}

/* --- Reset & Base Styles --- */
*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
    border-width: 0;
    border-style: solid;
    border-color: var(--border-color);
}

html {
    scroll-behavior: smooth;
    font-size: var(--font-size-root);
    line-height: var(--line-height-base);
    -webkit-text-size-adjust: 100%;
    tab-size: 4;
}

body {
    font-family: var(--font-family-sans);
    background-color: var(--bg-base);
    color: var(--text-dark);
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    padding-top: var(--header-height);
    padding-bottom: var(--bottom-nav-height);
    transition: background-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing);
}

main {
    flex-grow: 1;
}

a {
    color: var(--link-color);
    text-decoration: none;
    transition: color var(--transition-duration) var(--transition-timing);
}
a:hover, a:focus-visible {
    color: var(--link-hover-color);
    text-decoration: underline;
}

img, svg, video, canvas, audio, iframe, embed, object {
    max-width: 100%;
    height: auto;
    display: block;
    vertical-align: middle;
}

h1, h2, h3, h4, h5, h6 {
    margin-bottom: var(--spacing-md);
    line-height: var(--line-height-heading);
    font-weight: var(--font-weight-bold);
    color: var(--text-dark);
}
h1 { font-size: 2rem; font-weight: var(--font-weight-bold); }
h2 { font-size: 1.75rem; font-weight: var(--font-weight-semibold); }
h3 { font-size: 1.5rem; font-weight: var(--font-weight-semibold); }
h4 { font-size: 1.25rem; font-weight: var(--font-weight-medium); }
h5 { font-size: 1rem; font-weight: var(--font-weight-medium); }
h6 { font-size: 0.875rem; font-weight: var(--font-weight-medium); }


p { margin-bottom: var(--spacing-md); }

ul, ol {
     list-style-position: inside;
     padding-left: 0;
     margin-bottom: var(--spacing-md);
}
ul li, ol li { margin-bottom: var(--spacing-xs); }

/* --- Accessibility --- */
.sr-only {
    position: absolute !important;
    width: 1px !important;
    height: 1px !important;
    padding: 0 !important;
    margin: -1px !important;
    overflow: hidden !important;
    clip: rect(0, 0, 0, 0) !important;
    white-space: nowrap !important;
    border: 0 !important;
}

:focus-visible {
    outline: 2px solid var(--border-focus);
    outline-offset: 2px;
    box-shadow: var(--box-shadow-focus);
    border-radius: var(--border-radius-sm);
}
*:focus:not(:focus-visible) {
    outline: none;
}

/* --- Layout & Structure --- */
.app-header {
    background: var(--bg-card);
    color: var(--text-dark);
    padding: 0 var(--spacing-lg);
    height: var(--header-height);
    display: flex;
    justify-content: space-between;
    align-items: center;
    box-shadow: var(--box-shadow-sm);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: var(--z-index-header);
    transition: background-color var(--transition-duration) var(--transition-timing), border-bottom-color var(--transition-duration) var(--transition-timing);
    border-bottom: 1px solid var(--border-color);
}
.theme-dark .app-header {
     background: var(--bg-card-dark);
}

.app-header .app-title {
    margin: 0;
    font-size: 1.25rem;
    font-weight: var(--font-weight-semibold);
    color: var(--primary-color);
    text-shadow: none;
    cursor: pointer;
    border: none;
    background: none;
    padding: var(--spacing-xs) var(--spacing-sm);
    border-radius: var(--border-radius-sm);
    display: inline-flex;
    align-items: center;
}
.app-header .app-title i { margin-right: var(--spacing-sm); }

.header-actions {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
}

.theme-toggle-button {
    padding: var(--spacing-xs);
    background-color: transparent;
    border: none;
    color: var(--text-light);
}
.theme-toggle-button:hover, .theme-toggle-button:focus-visible {
    color: var(--text-dark);
    background-color: var(--bg-hover);
}
.theme-toggle-button .theme-icon-dark,
.theme-toggle-button .theme-icon-light { font-size: 1.25rem; }

.app-header #quit-study-header-button {
    color: var(--danger-color);
    background-color: transparent;
    border: 1px solid transparent;
}
.app-header #quit-study-header-button:hover, .app-header #quit-study-header-button:focus-visible {
     background-color: var(--danger-dark-light);
     color: var(--text-on-danger);
     border-color: var(--danger-dark-light);
}
.theme-dark .app-header #quit-study-header-button:hover,
.theme-dark .app-header #quit-study-header-button:focus-visible {
    background-color: var(--danger-dark-dark);
}


.app-nav {
    position: fixed;
    bottom: 0;
    left: 0;
    right: 0;
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: space-around;
    height: var(--bottom-nav-height);
    z-index: var(--z-index-bottom-nav);
    box-shadow: 0 -2px 5px -2px var(--shadow-color);
    transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
}
.app-nav .nav-button {
    background: none;
    border: none;
    color: var(--text-light);
    padding: var(--spacing-xxs) 0 var(--spacing-xs);
    font-size: var(--font-size-sm);
    cursor: pointer;
    border-radius: 0;
    transition: color var(--transition-duration) var(--transition-timing), background-color var(--transition-duration) var(--transition-timing);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    flex-grow: 1;
    min-width: 60px;
    line-height: 1.2;
    text-align: center;
    height: 100%;
    position: relative;
}
.app-nav .nav-button i {
    font-size: 1.5rem;
    margin-bottom: 2px;
    width: 1.75em;
    text-align: center;
}
.app-nav .nav-button .nav-text {
    font-size: 0.75rem;
    display: block;
}
.app-nav .nav-button:hover:not(.active), .app-nav .nav-button:focus-visible:not(.active) {
    color: var(--primary-color);
    background-color: var(--bg-hover);
}
.app-nav .nav-button.active {
    color: var(--primary-color);
    font-weight: var(--font-weight-medium);
}
.app-nav .nav-button.active::before {
    content: '';
    position: absolute;
    top: 0;
    left: 50%;
    transform: translateX(-50%);
    width: 40%;
    height: 3px;
    background-color: var(--primary-color);
    border-radius: 0 0 3px 3px;
}
.app-nav .nav-button:focus-visible {
    outline: none;
    box-shadow: inset 0 0 0 2px var(--border-focus);
}

#app-container {
    padding: var(--spacing-lg);
    max-width: var(--max-content-width);
    width: 100%;
    margin: 0 auto;
}

.app-footer {
    text-align: center;
    padding: var(--spacing-lg);
    font-size: var(--font-size-sm);
    color: var(--text-light);
    background-color: transparent;
    border-top: 1px solid var(--border-color);
    transition: background-color var(--transition-duration) var(--transition-timing), color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
    margin-top: var(--spacing-xxl);
}

/* --- Screen Management --- */
.screen {
    display: none;
    animation: screenFadeIn 0.35s var(--transition-timing) forwards;
}
.screen.active { display: block; }

@keyframes screenFadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0); }
}

.screen-title {
    color: var(--text-dark);
    margin-bottom: var(--spacing-xl);
    text-align: center;
    font-weight: var(--font-weight-semibold);
}
.screen-title i { margin-right: var(--spacing-sm); color: var(--primary-color); }
.screen-title span {
     font-weight: var(--font-weight-medium);
     color: var(--text-light);
}

/* --- Card Styles --- */
.card {
    background-color: var(--bg-card);
    padding: var(--spacing-lg);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--box-shadow);
    margin-bottom: var(--spacing-xl);
    border: 1px solid var(--border-color);
    transition: background-color var(--transition-duration) var(--transition-timing), box-shadow var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
}
.card-header {
    font-size: 1.25rem;
    color: var(--text-dark);
    margin: calc(-1 * var(--spacing-lg)) calc(-1 * var(--spacing-lg)) var(--spacing-lg);
    padding: var(--spacing-md) var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
    border-top-left-radius: inherit;
    border-top-right-radius: inherit;
    background-color: var(--bg-card-secondary);
    display: flex;
    justify-content: space-between;
    align-items: center;
    transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
}
.card-header i { margin-right: var(--spacing-sm); color: var(--primary-color); }
.card-content {
    padding-top: var(--spacing-xs);
}
.card-footer-actions {
    margin: var(--spacing-lg) calc(-1 * var(--spacing-lg)) calc(-1 * var(--spacing-lg));
    padding: var(--spacing-md) var(--spacing-lg);
    border-top: 1px solid var(--border-color);
    background-color: var(--bg-card-secondary);
    border-bottom-left-radius: inherit;
    border-bottom-right-radius: inherit;
    text-align: right;
}
.card-footer-actions .button {
    margin-left: var(--spacing-md);
}
.card-footer-actions .button:first-child { margin-left: 0; }


/* --- Buttons & Inputs --- */
.button {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: var(--spacing-sm) var(--spacing-lg);
    margin: var(--spacing-xxs);
    cursor: pointer;
    border: 1px solid transparent;
    border-radius: var(--border-radius);
    font-size: var(--font-size-base);
    font-weight: var(--font-weight-medium);
    text-align: center;
    text-decoration: none;
    line-height: 1.5;
    vertical-align: middle;
    user-select: none;
    transition-property: color, background-color, border-color, text-decoration-color, fill, stroke, opacity, box-shadow, transform, filter, backdrop-filter;
    transition-duration: var(--transition-duration);
    transition-timing-function: var(--transition-timing);
    position: relative;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
}

.button i {
    margin-right: var(--spacing-sm);
    line-height: 1;
}
.button.icon-button i { margin-right: 0; }


.button:disabled, .button[disabled] {
    cursor: not-allowed;
    background-color: var(--bg-disabled);
    color: var(--text-disabled);
    border-color: transparent;
    box-shadow: none;
    opacity: 0.7;
}
.button:not(:disabled):hover {
    filter: brightness(1.05);
    transform: translateY(-1px);
    box-shadow: var(--box-shadow-sm);
}
.button:not(:disabled):active {
    filter: brightness(0.95);
    transform: translateY(0px);
    box-shadow: var(--box-shadow-xs);
}


/* Button Color Variants */
.button.primary   { background-color: var(--primary-color); color: var(--text-on-primary); border-color: var(--primary-color); }
.button.primary:not(:disabled):hover, .button.primary:not(:disabled):focus-visible { background-color: var(--primary-dark); border-color: var(--primary-dark); }

.button.secondary {
    background-color: var(--bg-card-secondary);
    color: var(--text-dark);
    border: 1px solid var(--border-color);
}
.button.secondary:not(:disabled):hover, .button.secondary:not(:disabled):focus-visible {
    background-color: var(--bg-hover);
    border-color: var(--secondary-dark);
    color: var(--primary-color);
}

.button.success   { background-color: var(--success-color); color: var(--text-on-success); border-color: var(--success-color); }
.button.success:not(:disabled):hover, .button.success:not(:disabled):focus-visible { background-color: var(--success-dark); border-color: var(--success-dark); }

.button.danger    { background-color: var(--danger-color); color: var(--text-on-danger); border-color: var(--danger-color); }
.button.danger:not(:disabled):hover, .button.danger:not(:disabled):focus-visible { background-color: var(--danger-dark); border-color: var(--danger-dark); }

.button.warning   { background-color: var(--warning-color); color: var(--text-on-warning); border-color: var(--warning-color); }
.button.warning:not(:disabled):hover, .button.warning:not(:disabled):focus-visible { background-color: var(--warning-dark); border-color: var(--warning-dark); }

/* Button Size Variants */
.button.large { padding: var(--spacing-md) var(--spacing-xl); font-size: var(--font-size-lg); }
.button.small { padding: var(--spacing-xs) var(--spacing-md); font-size: var(--font-size-sm); }

/* Icon Only Button */
.button.icon-button {
    padding: var(--spacing-sm);
    min-width: auto;
}
.button.icon-button.small { padding: var(--spacing-xs); }
.button.icon-button.large { padding: var(--spacing-md); }

/* File Input Styling */
input[type="file"] {
   position: absolute;
   width: 1px;
   height: 1px;
   padding: 0;
   margin: -1px;
   overflow: hidden;
   clip: rect(0, 0, 0, 0);
   white-space: nowrap;
   border-width: 0;
}
input[type="file"]:focus-visible + .file-label {
    /* Rely on button's :focus-visible style */
}

/* Standard Input Fields (Text, Number, Search, Select, Textarea) */
input[type="text"],
input[type="number"],
input[type="search"],
input[type="email"],
input[type="password"],
select,
textarea {
    display: block;
    width: 100%;
    padding: var(--spacing-sm) var(--spacing-md);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    margin-bottom: var(--spacing-md);
    font-size: var(--font-size-base);
    font-family: inherit;
    line-height: 1.5;
    color: var(--text-dark);
    background-color: var(--bg-input);
    transition-property: border-color, box-shadow, background-color, color;
    transition-duration: var(--transition-duration);
    transition-timing-function: var(--transition-timing);
    -webkit-appearance: none;
    -moz-appearance: none;
    appearance: none;
}

input::placeholder,
textarea::placeholder {
    color: var(--text-placeholder);
    opacity: 1;
}

input[type=number]::-webkit-inner-spin-button,
input[type=number]::-webkit-outer-spin-button {
  -webkit-appearance: none;
  margin: 0;
}
input[type=number] { -moz-appearance: textfield; }

input[type="search"]::-webkit-search-cancel-button { display: none; }


input:focus-visible,
select:focus-visible,
textarea:focus-visible {
    border-color: var(--border-focus);
    box-shadow: var(--box-shadow-focus);
    background-color: var(--bg-input);
}

input:disabled,
select:disabled,
textarea:disabled {
    background-color: var(--bg-disabled);
    color: var(--text-disabled);
    border-color: var(--border-color);
    cursor: not-allowed;
    box-shadow: none;
    opacity: 0.7;
}

select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23333' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
    background-position: right var(--spacing-md) center;
    background-repeat: no-repeat;
    background-size: 1em 1em;
    padding-right: calc(var(--spacing-md) * 2.5);
}
.theme-dark select {
    background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 16 16'%3e%3cpath fill='none' stroke='%23ccc' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M2 5l6 6 6-6'/%3e%3c/svg%3e");
}
select:disabled { background-image: none; }

textarea { resize: vertical; min-height: 120px; }

/* Checkbox/Radio styling */
input[type="checkbox"],
input[type="radio"] {
    appearance: none;
    -webkit-appearance: none;
    display: inline-block;
    position: relative;
    width: 1.25em;
    height: 1.25em;
    border: 2px solid var(--border-color);
    background-color: var(--bg-input);
    vertical-align: middle;
    margin-right: var(--spacing-xs);
    cursor: pointer;
    transition: all var(--transition-duration) var(--transition-timing);
    flex-shrink: 0;
}
input[type="checkbox"] { border-radius: var(--border-radius-sm); }
input[type="radio"] { border-radius: 50%; }

input[type="checkbox"]:checked,
input[type="radio"]:checked {
    background-color: var(--primary-color);
    border-color: var(--primary-color);
}
input[type="checkbox"]:checked::before {
    content: '';
    display: block;
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0.35em;
    height: 0.65em;
    border: solid var(--text-on-primary);
    border-width: 0 0.18em 0.18em 0;
    transform: translate(-50%, -60%) rotate(45deg);
}
input[type="radio"]:checked::before {
    content: '';
    display: block;
    position: absolute;
    top: 50%;
    left: 50%;
    width: 0.5em;
    height: 0.5em;
    background-color: var(--text-on-primary);
    border-radius: 50%;
    transform: translate(-50%, -50%);
}

input[type="checkbox"]:disabled,
input[type="radio"]:disabled {
    border-color: var(--border-color);
    background-color: var(--bg-disabled);
    cursor: not-allowed;
    opacity: 0.7;
}
input[type="checkbox"]:disabled + label,
input[type="radio"]:disabled + label {
    color: var(--text-disabled);
    cursor: not-allowed;
}
input[type="checkbox"]:disabled::before,
input[type="radio"]:disabled::before {
    border-color: var(--text-disabled);
    background-color: var(--text-disabled);
}

label {
    font-weight: var(--font-weight-medium);
    color: var(--text-dark);
    margin-bottom: var(--spacing-xs);
    display: inline-block;
    cursor: pointer;
    transition: color var(--transition-duration) var(--transition-timing);
}
label.checkbox-label,
label.radio-label {
    font-weight: var(--font-weight-normal);
    vertical-align: middle;
}

fieldset {
    border: none;
    padding: 0;
    margin: 0;
    margin-bottom: var(--spacing-lg);
}
legend {
    padding: 0;
    font-size: var(--font-size-lg);
    font-weight: var(--font-weight-semibold);
    margin-bottom: var(--spacing-md);
    width: 100%;
}


/* --- Helper & Utility Classes --- */
.status-message {
    display: inline-block;
    font-size: var(--font-size-sm);
    color: var(--text-light);
    transition: color 0.3s ease-out, opacity 0.3s ease-out;
    margin-left: var(--spacing-md);
    min-height: 1.2em;
    line-height: 1.4;
    vertical-align: middle;
}
.status-message:empty { display: none; }

.status-message.info    { color: var(--info-color); font-weight: var(--font-weight-medium);}
.status-message.success { color: var(--success-color); font-weight: var(--font-weight-bold);}
.status-message.warning { color: var(--warning-color); font-weight: var(--font-weight-bold);}
.status-message.error   { color: var(--danger-color); font-weight: var(--font-weight-bold);}

.note {
    font-size: var(--font-size-sm);
    color: var(--text-light);
    line-height: 1.5;
    display: block;
}

.close-button {
    background: none;
    border: none;
    color: inherit;
    font-size: 1.5rem;
    line-height: 1;
    cursor: pointer;
    padding: var(--spacing-xs);
    opacity: 0.6;
    transition: opacity var(--transition-duration) var(--transition-timing);
    border-radius: 50%;
}
.close-button:hover, .close-button:focus-visible { opacity: 1; background-color: var(--bg-hover); }
.close-button:focus-visible {
    outline-offset: 1px;
}

@media print {
    body { padding-top: 0 !important; padding-bottom: 0 !important; background-color: #fff; color: #000; }
    .no-print, .no-print * { display: none !important; }
    #app-container { padding: var(--spacing-lg) 0; margin: 0 auto;}
    .card { box-shadow: none; border: 1px solid #ccc; margin-bottom: var(--spacing-md); page-break-inside: avoid;}
    .card-header { background-color: #eee; padding: var(--spacing-sm) var(--spacing-md); font-size: 1.1em;}
    .screen-title { text-align: left; font-size: 1.5em; margin-bottom: var(--spacing-lg); color: #000; }
    a { color: #000; text-decoration: underline; }
}

.critical-error-display {
    background-color: var(--danger-color-light);
    color: var(--white-color);
    padding: var(--spacing-xl);
    border-radius: var(--border-radius);
    margin: var(--spacing-xl) auto;
    max-width: 800px;
    text-align: center;
    font-weight: var(--font-weight-medium);
    border: 1px solid var(--danger-dark-light);
    box-shadow: var(--box-shadow-lg);
}
.theme-dark .critical-error-display {
    background-color: var(--danger-color-dark);
    color: var(--white-color);
    border-color: var(--danger-dark-dark);
}

/* ========================== */
/* Specific Component Styles  */
/* ========================== */

/* --- Home Screen --- */
#deck-management-section .deck-controls {
     margin-bottom: var(--spacing-lg);
     display: flex;
     flex-wrap: wrap;
     align-items: center;
     gap: var(--spacing-md);
}
#json-file-input {
    display: none;
}

#deck-list-controls {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    padding: var(--spacing-md);
    background-color: var(--bg-card-secondary);
    border-radius: var(--border-radius);
}
#deck-list-controls .search-control,
#deck-list-controls .sort-control {
    display: flex;
    align-items: center;
    gap: var(--spacing-sm);
    flex-grow: 1;
}
#deck-list-controls input[type="search"],
#deck-list-controls select {
     margin-bottom: 0;
     flex-grow: 1;
     max-width: 350px;
     padding: var(--spacing-sm) var(--spacing-md);
}
#deck-list-controls select {
     flex-grow: 0;
     min-width: 220px;
}

#deck-list-container {
    margin-top: var(--spacing-md);
}
#deck-list {
    list-style: none;
    padding: 0;
    max-height: 400px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    background-color: var(--bg-base);
}
#deck-list li:not(.no-decks-message) {
    padding: var(--spacing-md) var(--spacing-lg);
    margin: 0;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    flex-wrap: nowrap;
    justify-content: space-between;
    align-items: center;
    transition: background-color var(--transition-duration) var(--transition-timing), border-color var(--transition-duration) var(--transition-timing);
    cursor: pointer;
    gap: var(--spacing-md);
}
#deck-list li:last-child { border-bottom: none; }
#deck-list li:hover, #deck-list li:focus-visible {
    background-color: var(--bg-hover);
    outline: none;
}
#deck-list li:focus-visible {
    box-shadow: inset 0 0 0 2px var(--border-focus);
    z-index: 1;
}
#deck-list li.active-deck {
    font-weight: var(--font-weight-semibold);
    background-color: var(--primary-light);
    border-left: 4px solid var(--primary-color);
    padding-left: calc(var(--spacing-lg) - 4px);
    cursor: default;
}
.theme-dark #deck-list li.active-deck {
     background-color: var(--primary-light-dark);
     border-left-color: var(--primary-color-dark);
}

#deck-list .deck-info {
     flex-grow: 1;
     min-width: 0;
     overflow: hidden;
}
#deck-list .deck-name {
    display: block;
    font-weight: var(--font-weight-medium);
    margin-bottom: var(--spacing-xxs);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
    color: var(--text-dark);
}
#deck-list .deck-history {
    display: block;
    font-size: var(--font-size-sm);
    color: var(--text-light);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
}
#deck-list .deck-actions {
    flex-shrink: 0;
    display: flex;
    gap: var(--spacing-sm);
}
#deck-list .deck-actions .button {
    padding: var(--spacing-xs) var(--spacing-sm);
    font-size: var(--font-size-sm);
    margin: 0;
}

.no-decks-message {
    color: var(--text-light);
    font-style: italic;
    padding: var(--spacing-xl);
    text-align: center;
    line-height: 1.6;
}

#current-deck-study-options {
    margin-top: var(--spacing-xl);
}
.current-deck-info-panel {
    padding-bottom: var(--spacing-lg);
    margin-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
}
.current-deck-info-panel .current-deck-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-md);
}
.current-deck-info-panel .deck-title-value {
    font-size: 1.25rem;
    font-weight: var(--font-weight-semibold);
    color: var(--text-dark);
}
.current-deck-info-panel .deck-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
    gap: var(--spacing-sm) var(--spacing-md);
}
.current-deck-info-panel p { margin: 0; font-size: 0.95rem; color: var(--text-light); }
.current-deck-info-panel p strong { color: var(--text-dark); margin-left: var(--spacing-xs); font-weight: var(--font-weight-medium);}


/* Study Filter Styles - Updated for Dropdown */
.study-filter-panel {
    padding-top: var(--spacing-lg);
}
.study-filter-panel .filter-header {
    font-size: 1.1rem;
    color: var(--text-dark);
    margin-bottom: var(--spacing-sm);
    font-weight: var(--font-weight-semibold);
}
.study-filter-panel .filter-header i { margin-right: var(--spacing-sm); color: var(--primary-color); }

.study-filter-panel .control-group { /* Wrapper for select */
    margin-bottom: var(--spacing-sm);
}
#study-filter-select {
    width: 100%;
    max-width: 400px;
    margin-bottom: var(--spacing-xs);
}
/* Removed old .filter-item, .filter-button styles as they are no longer used */

#filtered-question-count-display {
    text-align: right;
    font-size: var(--font-size-sm);
    color: var(--text-light);
    margin-top: var(--spacing-md);
}

.start-buttons {
    text-align: center;
}

/* --- Study Screen --- */
/* ... (学習画面のスタイルは変更なし) ... */
#study-screen {
    padding-bottom: calc(var(--bottom-nav-height) + 90px);
}
#study-progress-container {
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
    margin-bottom: var(--spacing-lg);
    visibility: hidden;
}
#study-progress-bar {
    flex-grow: 1;
    height: 8px;
    appearance: none;
    -webkit-appearance: none;
    border: none;
    border-radius: 8px;
    overflow: hidden;
    background-color: var(--bg-disabled);
}
#study-progress-bar::-webkit-progress-bar {
    background-color: var(--bg-disabled);
    border-radius: 8px;
}
#study-progress-bar::-webkit-progress-value {
    background-color: var(--primary-color);
    border-radius: 8px;
    transition: width 0.3s ease;
}
#study-progress-bar::-moz-progress-bar {
    background-color: var(--primary-color);
    border-radius: 8px;
    transition: width 0.3s ease;
}
#study-progress-text {
     font-size: var(--font-size-sm);
     color: var(--text-light);
     flex-shrink: 0;
     font-variant-numeric: tabular-nums;
}

#study-card {
    border-left: 5px solid transparent;
    transition: transform 0.3s ease-out, box-shadow 0.3s ease-out, border-left-color 0.3s ease-out;
}
#study-card.correct-answer { border-left-color: var(--success-color); }
#study-card.incorrect-answer { border-left-color: var(--danger-color); }

.question-label {
    display: flex;
    justify-content: space-between;
    align-items: baseline;
}
.card-label {
    display: block;
    font-weight: var(--font-weight-medium);
    color: var(--text-light);
    font-size: var(--font-size-sm);
    text-transform: uppercase;
    letter-spacing: 0.05em;
    margin-bottom: var(--spacing-xs);
}
#question-counter {
    font-size: var(--font-size-sm);
    color: var(--text-light);
    font-weight: var(--font-weight-normal);
    text-transform: none;
}
#question-text {
    font-size: 1.375rem;
    margin-bottom: var(--spacing-lg);
    line-height: 1.5;
    color: var(--text-dark);
}

.options-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: var(--spacing-md);
}
#options-buttons-container .option-button {
    width: 100%;
    margin: 0;
    padding: var(--spacing-md) var(--spacing-lg);
    font-size: 1rem;
    background-color: var(--bg-card);
    border: 1px solid var(--border-color);
    color: var(--text-dark);
    text-align: left;
    justify-content: flex-start;
    line-height: 1.5;
    min-height: 56px;
    border-radius: var(--border-radius);
}
#options-buttons-container .option-button:hover:not(:disabled),
#options-buttons-container .option-button:focus-visible:not(:disabled) {
     background-color: var(--bg-hover);
     border-color: var(--primary-color);
     color: var(--primary-color);
     box-shadow: var(--box-shadow-xs);
}

#options-buttons-container .option-button.success {
    background-color: hsl(var(--success-hue), 70%, 92%);
    border-color: var(--success-color);
    color: var(--success-dark);
    font-weight: var(--font-weight-semibold);
}
#options-buttons-container .option-button.danger {
    background-color: hsl(var(--danger-hue), 80%, 96%);
    border-color: var(--danger-color);
    color: var(--danger-dark);
}
.theme-dark #options-buttons-container .option-button.success {
     background-color: hsla(var(--success-hue), 40%, 30%, 0.6);
     border-color: var(--success-color-dark);
     color: var(--success-color-dark);
}
.theme-dark #options-buttons-container .option-button.danger {
     background-color: hsla(var(--danger-hue), 40%, 30%, 0.6);
     border-color: var(--danger-color-dark);
     color: var(--danger-color-dark);
}

#options-buttons-container .option-button:disabled:not(.success):not(.danger) {
    opacity: 0.6;
    background-color: var(--bg-card);
    border-color: var(--border-color);
    color: var(--text-light);
    cursor: default;
}
.answer-feedback-area {
    margin-top: var(--spacing-lg);
    padding-top: var(--spacing-lg);
    border-top: 1px solid var(--border-color);
}
#feedback-container {
    margin-bottom: var(--spacing-md);
    min-height: 2em;
}
#feedback-message {
    display: inline-flex;
    align-items: center;
    gap: var(--spacing-sm);
    font-size: 1.25rem;
    font-weight: var(--font-weight-semibold);
    padding: var(--spacing-sm) var(--spacing-md);
    border-radius: var(--border-radius);
    animation: feedbackFadeInScale 0.3s var(--transition-timing) forwards;
}
#feedback-message .feedback-icon { font-size: 1.1em; }

@keyframes feedbackFadeInScale {
    from { opacity: 0; transform: scale(0.95) translateY(5px); }
    to { opacity: 1; transform: scale(1) translateY(0); }
}

#feedback-container.correct #feedback-message {
    background-color: var(--eval-easy-bg);
    color: var(--eval-easy-text);
}
#feedback-container.incorrect #feedback-message {
    background-color: var(--eval-difficult-bg);
    color: var(--eval-difficult-text);
}
.answer-details { margin-top: var(--spacing-md); }
.answer-details #answer-text,
.answer-details #explanation-text {
    font-size: 1rem;
    line-height: 1.6;
    margin-bottom: var(--spacing-sm);
    padding: var(--spacing-sm) var(--spacing-md);
    background-color: var(--bg-card-secondary);
    border-radius: var(--border-radius-sm);
}
.retry-button-study { margin-top: var(--spacing-md); }

.evaluation-panel {
    position: fixed;
    bottom: var(--bottom-nav-height);
    left: 0;
    right: 0;
    background: var(--bg-card);
    border-top: 1px solid var(--border-color);
    padding: var(--spacing-md) var(--spacing-lg);
    z-index: var(--z-index-study-eval-panel);
    box-shadow: 0 -3px 10px -3px var(--shadow-color);
    transition: background-color var(--transition-duration), border-color var(--transition-duration), transform 0.3s var(--transition-timing);
    display: flex;
    flex-direction: column;
    align-items: center;
    transform: translateY(100%);
    visibility: hidden;
}
#evaluation-controls[style*="display: flex"] {
    transform: translateY(0);
    visibility: visible;
}
#evaluation-controls[style*="display: none"] {
    transform: translateY(100%);
    visibility: hidden;
}

.evaluation-panel .eval-instruction {
    margin-bottom: var(--spacing-sm);
    font-weight: var(--font-weight-medium);
    font-size: 1rem;
}
.eval-buttons-container {
    display: flex;
    justify-content: center;
    gap: var(--spacing-md);
    flex-wrap: wrap;
    width: 100%;
    max-width: 550px;
}
.eval-button {
    flex-grow: 1;
    min-width: 130px;
    padding: var(--spacing-sm) var(--spacing-md);
    font-weight: var(--font-weight-semibold);
    font-size: 1rem;
    margin: 0;
    box-shadow: var(--box-shadow-xs);
    border-width: 2px !important;
    border-style: solid !important;
}
.eval-button i { margin-right: var(--spacing-xs); }

.eval-button.difficult { background-color: var(--eval-difficult-bg); color: var(--eval-difficult-text); border-color: var(--eval-difficult-text); }
.eval-button.normal { background-color: var(--eval-normal-bg); color: var(--eval-normal-text); border-color: var(--eval-normal-text); }
.eval-button.easy { background-color: var(--eval-easy-bg); color: var(--eval-easy-text); border-color: var(--eval-easy-text); }

.eval-button:not(:disabled):hover, .eval-button:not(:disabled):focus-visible {
    transform: translateY(-2px) scale(1.03);
    box-shadow: var(--box-shadow-sm);
    filter: brightness(108%);
}

.completion-panel {
     text-align: center;
     animation: fadeInScale 0.4s var(--transition-timing) forwards;
}
.completion-panel .card-header { justify-content: center; background-color: var(--success-light); }
.theme-dark .completion-panel .card-header { background-color: var(--success-dark); }
.completion-panel .card-header h3 { color: var(--success-dark); font-size: 1.5rem; }
.theme-dark .completion-panel .card-header h3 { color: var(--text-on-success); }
.completion-panel p { margin-bottom: var(--spacing-sm); font-size: 1.1rem; }
.completion-panel strong { font-weight: var(--font-weight-semibold); color: var(--primary-color); }
.completion-panel .button { margin-top: var(--spacing-lg); }


/* --- Dashboard Screen --- */
/* ... (変更なし) ... */
.dashboard-deck-selector {
    padding: var(--spacing-md) var(--spacing-lg);
    margin-bottom: var(--spacing-xl);
    display: flex;
    align-items: center;
    gap: var(--spacing-md);
}
.dashboard-deck-selector label { margin-bottom: 0; font-weight: var(--font-weight-semibold); }
#dashboard-deck-select {
    width: auto;
    min-width: 280px;
    max-width: 100%;
    margin-bottom: 0;
}

#dashboard-overview .dashboard-stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: var(--spacing-md);
}
#dashboard-overview .dashboard-stats-grid div {
    background-color: var(--bg-base);
    padding: var(--spacing-md);
    border-radius: var(--border-radius);
    font-size: 1rem;
    border: 1px solid var(--border-color);
}
#dashboard-overview .dashboard-stats-grid strong {
    font-weight: var(--font-weight-semibold);
    color: var(--primary-dark);
    margin-left: var(--spacing-xs);
}

.chart-container {
    position: relative;
    height: 380px;
    width: 100%;
    margin-top: var(--spacing-xs);
    background: var(--bg-card);
    border-radius: var(--border-radius);
    padding: var(--spacing-md);
    box-shadow: inset 0 1px 3px var(--inner-shadow);
}
.chart-no-data {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: var(--text-light);
    text-align: center;
    padding: var(--spacing-lg);
    font-style: italic;
}

.dashboard-controls-toggle {
    display: none;
    width: 100%;
    margin-bottom: var(--spacing-md);
    justify-content: space-between;
    font-weight: var(--font-weight-medium);
    padding: var(--spacing-sm) var(--spacing-md);
}
.dashboard-controls-toggle .toggle-icon { transition: transform 0.3s var(--transition-timing); }
.dashboard-controls-toggle[aria-expanded="true"] .toggle-icon { transform: rotate(180deg); }

#dashboard-analysis-controls-panel {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
    gap: var(--spacing-md) var(--spacing-lg);
    padding: var(--spacing-md) 0;
    margin-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
    align-items: end;
    transition: max-height 0.3s ease-out, opacity 0.3s ease-out, visibility 0.3s linear, padding 0.3s ease-out, margin-bottom 0.3s ease-out, border-color 0.3s ease-out;
    overflow: hidden;
}
#dashboard-analysis-controls-panel.collapsed {
    max-height: 0;
    opacity: 0;
    visibility: hidden;
    padding-top: 0; padding-bottom: 0;
    margin-bottom: 0;
    border-bottom-color: transparent;
}
.control-group {
    display: flex;
    flex-direction: column;
    gap: var(--spacing-xs);
}
.control-group label { margin-bottom: 0; font-size: var(--font-size-sm); color: var(--text-light); }
.control-group select,
.control-group input[type="search"] {
    margin-bottom: 0;
    padding: var(--spacing-sm) var(--spacing-md);
    font-size: 0.95rem;
    width: 100%;
}
.control-group.search-control {
    display: flex;
    flex-direction: row;
    align-items: center;
    gap: var(--spacing-sm);
}
.control-group.search-control input[type="search"] { flex-grow: 1; }
.control-group.search-control .button { margin-left: 0; }

.view-mode-control {
    display: inline-flex;
    grid-column: 1 / -1;
    justify-self: start;
}
.view-mode-control .view-mode-button {
    margin: 0;
    border-radius: 0;
    position: relative;
    border-right-width: 0;
    padding: var(--spacing-sm) var(--spacing-md);
    background-color: var(--bg-card-secondary);
    color: var(--text-light);
    border: 1px solid var(--border-color);
}
.view-mode-control .view-mode-button:first-of-type {
    border-top-left-radius: var(--border-radius);
    border-bottom-left-radius: var(--border-radius);
}
.view-mode-control .view-mode-button:last-of-type {
    border-top-right-radius: var(--border-radius);
    border-bottom-right-radius: var(--border-radius);
    border-right-width: 1px;
}
.view-mode-control .view-mode-button.active {
    background-color: var(--primary-color);
    color: var(--text-on-primary);
    border-color: var(--primary-color);
    z-index: 1;
    font-weight: var(--font-weight-medium);
}
.view-mode-control .view-mode-button:not(.active):hover,
.view-mode-control .view-mode-button:not(.active):focus-visible {
    background-color: var(--bg-hover);
    color: var(--primary-color);
}
.items-per-page-control { justify-self: start; }
.items-per-page-control select { min-width: 80px; }

.analysis-view { display: none; }
.analysis-view.active { display: block; animation: screenFadeIn 0.3s ease-out forwards; }

#question-accuracy-list {
    max-height: 550px;
    overflow-y: auto;
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: 0;
    list-style: none;
    margin-top: 0;
    background-color: var(--bg-base);
}
.question-accuracy-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md);
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: background-color var(--transition-duration);
    gap: var(--spacing-md);
}
.question-accuracy-item:last-child { border-bottom: none; }
.question-accuracy-item:hover, .question-accuracy-item:focus-visible {
    background-color: var(--bg-hover);
    outline: none;
}
.question-accuracy-item:focus-visible {
     box-shadow: inset 0 0 0 2px var(--border-focus);
     z-index: 1;
}
.question-accuracy-item .question-text-preview {
    flex-grow: 1;
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
    font-size: 1rem;
    color: var(--text-dark);
}
.question-accuracy-item .score-container {
    display: flex;
    align-items: baseline;
    flex-shrink: 0;
    min-width: 120px;
    text-align: right;
    gap: var(--spacing-sm);
}
.question-accuracy-item .accuracy.low    { color: var(--danger-color); }
.question-accuracy-item .accuracy.medium { color: var(--warning-color); }
.question-accuracy-item .accuracy.high   { color: var(--success-color); }
.question-accuracy-item .accuracy.unanswered {
     color: var(--text-light);
     font-weight: var(--font-weight-normal);
     font-style: italic;
}
.question-accuracy-item .accuracy { font-weight: var(--font-weight-semibold); font-size: 1rem; }
.question-accuracy-item .answer-counts {
    font-size: var(--font-size-sm);
    color: var(--text-light);
    min-width: 40px;
    text-align: right;
    font-variant-numeric: tabular-nums;
}
#question-accuracy-list .info-message {
    padding: var(--spacing-lg);
    text-align: center;
    color: var(--text-light);
    font-style: italic;
}
.chart-description {
    text-align: center;
    margin-bottom: var(--spacing-sm);
    font-size: var(--font-size-sm);
    color: var(--text-light);
}
#question-accuracy-chart:hover { cursor: pointer; }

.pagination-controls {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: var(--spacing-md) 0;
    margin-top: var(--spacing-md);
    border-top: 1px solid var(--border-color);
    gap: var(--spacing-xs);
    flex-wrap: wrap;
}
.pagination-controls .button { margin: 0; }
.pagination-controls .page-ellipsis {
    color: var(--text-light);
    padding: 0 var(--spacing-xs);
    align-self: center;
    line-height: inherit;
}
.pagination-controls .page-info {
    font-size: 0.9rem;
    color: var(--text-dark);
    white-space: nowrap;
    padding: 0 var(--spacing-md);
    text-align: center;
    order: 10;
    flex-basis: 100%;
    margin-top: var(--spacing-xs);
}


/* --- Settings Screen --- */
#settings-screen .settings-container { max-width: 800px; margin: 0 auto; }
#settings-screen .settings-group {
    margin-bottom: var(--spacing-xl);
    padding-bottom: var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
}
#settings-screen .settings-group:last-of-type { border-bottom: none; margin-bottom: 0; }
#settings-screen .settings-header {
    font-size: 1.125rem;
    color: var(--primary-dark);
    padding-bottom: var(--spacing-sm);
    border-bottom: 1px solid var(--border-color);
    margin-bottom: var(--spacing-lg);
    font-weight: var(--font-weight-semibold);
}
#settings-screen .settings-header i { margin-right: var(--spacing-sm); }

#settings-screen .setting-item {
    margin-bottom: var(--spacing-lg);
    display: grid;
    grid-template-columns: minmax(180px, 1fr) 2fr;
    gap: var(--spacing-xs) var(--spacing-lg);
    align-items: start;
}
#settings-screen .setting-item > label:not(.checkbox-label) {
    grid-column: 1 / 2;
    text-align: right;
    font-weight: var(--font-weight-medium);
    padding-top: calc(var(--spacing-sm) + 2px);
    color: var(--text-dark);
}
#settings-screen .setting-item > div {
    grid-column: 2 / 3;
}
#settings-screen .setting-input,
#settings-screen .setting-select,
#settings-screen textarea {
     width: 100%;
     max-width: 300px;
     margin-bottom: var(--spacing-xs);
}
/* JSON生成用テキストエリアのスタイル */
#prompt-guide-screen textarea#plain-json-input, /* Prompt Guide Screen specific */
#settings-screen textarea#plain-json-input { /* Settings Screen specific (if exists there) */
    max-width: 100%;
    min-height: 150px;
    font-family: var(--font-family-code);
    font-size: 0.9rem;
}


/* Checkbox items */
#settings-screen .setting-item.checkbox-item {
    grid-template-columns: auto 1fr;
    align-items: center;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-md);
}
#settings-screen .setting-item.checkbox-item input[type="checkbox"] {
    grid-column: 1 / 2; margin-right: 0; margin-bottom: 0;
}
#settings-screen .setting-item.checkbox-item label.checkbox-label {
    grid-column: 2 / 3; text-align: left; margin-bottom: 0; padding-top: 0;
}
/* Button items */
#settings-screen .setting-item.button-item {
    grid-template-columns: minmax(180px, 1fr) auto 1fr;
    align-items: center;
}
#settings-screen .setting-item.button-item .button,
#settings-screen .setting-item.button-item .file-label {
    grid-column: 2 / 3; justify-self: start; margin: 0;
}
#settings-screen .setting-item.button-item .note,
#settings-screen .setting-item.button-item .setting-status {
     grid-column: 3 / 4; margin-left: var(--spacing-md); justify-self: start; margin-top: 0; align-self: center;
}
/* Danger Zone */
#settings-screen .setting-item.danger-zone {
     padding: var(--spacing-md);
     background-color: hsl(var(--danger-hue), 100%, 97%);
     border: 1px solid hsl(var(--danger-hue), 70%, 88%);
     border-radius: var(--border-radius);
}
.theme-dark #settings-screen .setting-item.danger-zone {
     background-color: hsla(var(--danger-hue), 40%, 20%, 0.5);
     border-color: hsla(var(--danger-hue), 40%, 30%, 0.8);
}
#settings-screen .setting-item.danger-zone > label { color: var(--danger-dark); }
#settings-screen .setting-item.danger-zone .note strong { color: var(--danger-dark); }

#settings-screen #settings-save-status { margin-top: var(--spacing-sm); height: 1.5em; }

/* --- Prompt Guide Screen --- */
.prompt-customization-fields {
     margin-bottom: var(--spacing-xl);
     border: 1px solid var(--border-color);
     border-radius: var(--border-radius);
     padding: var(--spacing-lg);
     background-color: var(--bg-card-secondary);
}
.prompt-customization-fields .settings-header { font-size: 1.1rem; } /* Match Settings screen headers */
.prompt-customization-fields .setting-item { /* Reuse setting-item for layout */
    grid-template-columns: 180px 1fr;
    margin-bottom: var(--spacing-md);
}
.prompt-customization-fields input[type="text"],
.prompt-customization-fields input[type="number"] {
     width: 100%; max-width: 450px; margin-bottom: 0;
}

pre.code-block {
    background-color: var(--bg-card-secondary);
    border: 1px solid var(--border-color);
    border-radius: var(--border-radius);
    padding: var(--spacing-md);
    overflow-x: auto;
    white-space: pre-wrap;
    word-wrap: break-word;
    font-family: var(--font-family-code);
    font-size: 0.9rem;
    margin-top: var(--spacing-sm);
    line-height: 1.6;
    max-height: 450px;
}
pre.code-block code { font-family: inherit; font-size: inherit; color: var(--text-dark); }
pre.code-block strong.prompt-placeholder {
    color: var(--primary-dark);
    font-weight: var(--font-weight-semibold);
    background-color: hsla(var(--primary-hue), 80%, 85%, 0.7);
    padding: 0.1em 0.3em;
    border-radius: 3px;
    display: inline-block;
}
.theme-dark pre.code-block strong.prompt-placeholder {
    color: var(--primary-color-dark);
    background-color: hsla(var(--primary-hue), 40%, 50%, 0.4);
}

.prompt-controls {
    margin: var(--spacing-lg) 0; display: flex; align-items: center; gap: var(--spacing-md);
}
#prompt-guide-screen ol { list-style: decimal; margin-left: var(--spacing-lg); padding-left: var(--spacing-md); }
#prompt-guide-screen code:not(pre code) {
    background-color: var(--bg-card-secondary);
    padding: 0.15em 0.3em;
    border-radius: var(--border-radius-sm);
    font-family: var(--font-family-code);
    font-size: 0.85em;
    color: var(--text-dark);
    border: 1px solid var(--border-color);
    word-break: break-all;
}
/* JSON Check and Generate Area in Prompt Guide */
#prompt-guide-screen .json-check-area,
#prompt-guide-screen .settings-group { /* Reusing settings-group for consistency if JSON generate is here */
    margin-top: var(--spacing-xl);
}
#prompt-guide-screen .json-check-area h4,
#prompt-guide-screen .settings-group .settings-header { /* Match header style */
    font-size: 1.1rem;
    color: var(--text-dark);
    margin-bottom: var(--spacing-sm);
    font-weight: var(--font-weight-semibold);
    padding-bottom: var(--spacing-xs);
    border-bottom: 1px solid var(--border-color);
}
#prompt-guide-screen .json-check-area textarea,
#prompt-guide-screen .settings-group textarea#plain-json-input { /* Styles for textareas */
    font-family: var(--font-family-code);
    font-size: 0.9rem;
    min-height: 150px;
    max-height: 300px;
    width: 100%; /* Ensure full width in its container */
}
#prompt-guide-screen .json-check-area .button,
#prompt-guide-screen .settings-group .button {
    margin-top: var(--spacing-sm);
}
#prompt-guide-screen #json-check-status,
#prompt-guide-screen #generate-json-status {
    display: block;
    margin-top: var(--spacing-xs);
}


/* --- Global Notification --- */
#global-notification {
    position: fixed;
    bottom: -120px;
    left: 50%;
    transform: translateX(-50%);
    background-color: var(--text-dark);
    color: var(--bg-card);
    padding: var(--spacing-md) var(--spacing-lg);
    border-radius: var(--border-radius);
    z-index: var(--z-index-notification);
    box-shadow: var(--box-shadow-lg);
    opacity: 0;
    transition: opacity 0.35s var(--transition-timing), bottom 0.35s var(--transition-timing), background-color 0.35s;
    display: flex;
    align-items: center;
    min-width: 280px;
    width: auto;
    max-width: calc(100% - (var(--spacing-lg) * 2));
    max-width: 500px;
    visibility: hidden;
    pointer-events: none;
}
#global-notification[aria-hidden="false"] {
    opacity: 1;
    bottom: calc(var(--bottom-nav-height) + var(--spacing-md));
    visibility: visible;
    pointer-events: auto;
}
#notification-icon { margin-right: var(--spacing-sm); font-size: 1.25rem; flex-shrink: 0; }
#notification-message { flex-grow: 1; line-height: 1.4; font-size: 0.95rem; }
#global-notification.success { background-color: var(--success-dark); color: var(--text-on-success); }
#global-notification.info    { background-color: var(--info-color); color: var(--text-on-primary); }
.theme-dark #global-notification.info { color: var(--black-color); }
#global-notification.warning { background-color: var(--warning-dark); color: var(--text-on-warning); }
#global-notification.error   { background-color: var(--danger-dark); color: var(--text-on-danger); }

#notification-close-button {
    margin-left: var(--spacing-md);
    color: inherit;
    font-size: 1.25rem;
    padding: var(--spacing-xxs);
    flex-shrink: 0;
}
#notification-close-button:hover { background-color: hsla(0, 0%, 100%, 0.1); }
.theme-dark #notification-close-button:hover { background-color: hsla(0, 0%, 0%, 0.2); }


/* --- Loading Overlay --- */
.loading-overlay {
    position: fixed;
    inset: 0;
    background-color: hsla(0, 0%, 100%, 0.8);
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    z-index: var(--z-index-loading-overlay);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0s 0.3s linear;
    pointer-events: none;
}
.theme-dark .loading-overlay {
     background-color: hsla(var(--secondary-hue), 15%, 10%, 0.85);
}
.loading-overlay.active {
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s ease, visibility 0s linear;
    pointer-events: auto;
}
.spinner {
    border: 4px solid hsla(var(--primary-hue), 70%, 50%, 0.25);
    border-top-color: var(--primary-color);
    border-radius: 50%;
    width: 48px;
    height: 48px;
    animation: spin 0.8s linear infinite;
    margin-bottom: var(--spacing-lg);
}
@keyframes spin {
    to { transform: rotate(360deg); }
}
.loading-overlay p {
    font-weight: var(--font-weight-medium);
    color: var(--text-dark);
    font-size: 1.05rem;
}

/* --- Modal Dialog --- */
/* ... (変更なし) ... */
.modal-overlay {
    position: fixed;
    inset: 0;
    background-color: hsla(0, 0%, 0%, 0.5);
    display: flex;
    justify-content: center;
    align-items: center;
    z-index: var(--z-index-modal-overlay);
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s var(--transition-timing), visibility 0s 0.3s linear;
    padding: var(--spacing-lg);
    overflow-y: auto;
}
.modal-overlay[style*="display: flex"] {
    opacity: 1;
    visibility: visible;
    transition: opacity 0.3s var(--transition-timing), visibility 0s linear;
}
.theme-dark .modal-overlay { background-color: hsla(0, 0%, 0%, 0.7); }

.modal-dialog {
    background-color: var(--bg-card);
    color: var(--text-dark);
    border-radius: var(--border-radius-lg);
    box-shadow: var(--box-shadow-xl);
    width: 100%;
    max-width: 640px;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    overflow: hidden;
    transform: scale(0.95) translateY(-10px);
    transition: transform 0.3s var(--transition-timing);
    margin: auto;
}
.modal-overlay[style*="display: flex"] .modal-dialog {
     transform: scale(1) translateY(0);
}
.modal-dialog.modal-sm { max-width: 420px; }
.modal-dialog.modal-lg { max-width: 880px; }
.modal-dialog.modal-xl { max-width: 1140px; }

.modal-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--spacing-md) var(--spacing-lg);
    border-bottom: 1px solid var(--border-color);
    flex-shrink: 0;
}
.modal-title-text {
    font-size: 1.25rem;
    margin-bottom: 0;
    color: var(--text-dark);
    font-weight: var(--font-weight-semibold);
}
.modal-header .close-button { color: var(--text-light); }

.modal-body {
    padding: var(--spacing-lg);
    overflow-y: auto;
    flex-grow: 1;
}
.modal-body ul.modal-question-list {
    list-style: none;
    padding: 0;
}
.modal-body ul.modal-question-list li.modal-question-list-item {
    border-radius: var(--border-radius-sm);
    transition: background-color var(--transition-duration);
}
.modal-body ul.modal-question-list li.modal-question-list-item:hover,
.modal-body ul.modal-question-list li.modal-question-list-item:focus-visible {
    background-color: var(--bg-hover);
}


.modal-footer {
    padding: var(--spacing-md) var(--spacing-lg);
    border-top: 1px solid var(--border-color);
    display: flex;
    justify-content: flex-end;
    gap: var(--spacing-md);
    background-color: var(--bg-card-secondary);
    flex-shrink: 0;
    flex-wrap: wrap;
}
.modal-footer .button { margin: 0; }
.modal-body input.confirm-input {
    border-color: var(--border-color);
}
.modal-body input.confirm-input:focus-visible {
    border-color: var(--border-focus);
}

#question-detail-view h4 {
    font-size: 1.1rem;
    color: var(--primary-color);
    margin-top: var(--spacing-md);
    margin-bottom: var(--spacing-xs);
    padding-bottom: var(--spacing-xs);
    border-bottom: 1px solid var(--border-color);
}
#question-detail-view p, #question-detail-view ul { margin-bottom: var(--spacing-sm); }
#question-detail-view ul.question-history-list {
    padding: var(--spacing-sm);
    background-color: var(--bg-base);
    border-radius: var(--border-radius-sm);
    max-height: 250px;
}
#question-detail-view ul.question-history-list li {
    display: flex;
    justify-content: space-between;
    gap: var(--spacing-md);
    padding: var(--spacing-xxs) 0;
    border-bottom: 1px dashed hsl(var(--secondary-hue), 20%, 90%);
}
.theme-dark #question-detail-view ul.question-history-list li {
    border-bottom-color: hsl(var(--secondary-hue), 15%, 25%);
}
#question-detail-view ul.question-history-list li:last-child { border-bottom: none; }
#question-detail-view ul.question-history-list .history-status.correct { color: var(--success-color); font-weight: var(--font-weight-medium); }
#question-detail-view ul.question-history-list .history-status.incorrect { color: var(--danger-color); font-weight: var(--font-weight-medium); }
#question-detail-view ul.question-history-list .eval { font-style: italic; font-size: 0.9em; opacity: 0.8; }


/* --- Responsive Design Adjustments --- */
/* ... (変更なし) ... */
@media (max-width: 992px) { /* Large Tablets & Small Laptops */
    html { font-size: 15px; }
    #app-container { padding: var(--spacing-md); }
    .app-header { padding: 0 var(--spacing-md); }
    .card { padding: var(--spacing-md); }
    .card-header { padding: var(--spacing-sm) var(--spacing-md); margin-left: calc(-1 * var(--spacing-md)); margin-right: calc(-1 * var(--spacing-md)); }

    #dashboard-analysis-controls-panel { grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); }
    .view-mode-control { grid-column: auto; } /* Allow natural flow */

    #settings-screen .setting-item { grid-template-columns: minmax(150px, 1fr) 2fr; }
    #prompt-guide-screen .setting-item { grid-template-columns: minmax(150px, 1fr) 2fr; } /* Added for prompt guide consistency */

}

@media (max-width: 768px) { /* Small Tablets & Large Phones */
    body { padding-top: calc(var(--header-height) - 8px); } /* Slightly less padding for smaller header */
    .app-header { height: calc(var(--header-height) - 8px); }
    .app-header .app-title { font-size: 1.1rem; }
    .app-nav .nav-text { display: none; }
    .app-nav .nav-button i { font-size: 1.6rem; }

    #app-container { padding: var(--spacing-sm); }
    .screen-title { font-size: 1.5rem; margin-bottom: var(--spacing-lg); }

    /* Home Screen Mobile */
    #deck-list { max-height: 350px; }
    #deck-list li { flex-direction: column; align-items: stretch; padding: var(--spacing-sm); }
    #deck-list .deck-info { margin-bottom: var(--spacing-xs); width: 100%; }
    #deck-list .deck-actions { width: 100%; justify-content: flex-end; margin-top: var(--spacing-xs); }
    .current-deck-info-panel .current-deck-header { flex-direction: column; align-items: flex-start; }
    /* Home study filter dropdown mobile */
    .study-filter-panel .control-group { margin-bottom: var(--spacing-sm); }
    #study-filter-select { width: 100%; max-width: none; }


    /* Study Screen Mobile */
    #study-screen { padding-bottom: calc(var(--bottom-nav-height) + 100px); }
    .options-grid { grid-template-columns: 1fr; gap: var(--spacing-sm); }
    #question-text { font-size: 1.25rem; }
    .evaluation-panel { padding: var(--spacing-sm) var(--spacing-md); }
    .eval-buttons-container { gap: var(--spacing-sm); }
    .eval-button { min-width: 100px; font-size: 0.95rem; padding: var(--spacing-xs) var(--spacing-sm); }

    /* Dashboard Mobile */
    .dashboard-deck-selector { flex-direction: column; align-items: stretch; }
    #dashboard-deck-select { width: 100%; min-width: 0; }
    .dashboard-controls-toggle { display: flex; }
    #dashboard-analysis-controls-panel {
        grid-template-columns: 1fr; /* Single column for filters */
        border-bottom: none;
        padding: var(--spacing-md) 0 0;
    }
    #dashboard-analysis-controls-panel.collapsed { margin-bottom: 0; padding-top:0; }
    .control-group.search-control { flex-direction: column; align-items: stretch; }
    .control-group.search-control .button { width: 100%; margin-top: var(--spacing-xs); }
    .view-mode-control, .items-per-page-control { justify-self: stretch; }
    .view-mode-control .button { flex-grow: 1; }

    #dashboard-overview .dashboard-stats-grid { grid-template-columns: 1fr; }
    .chart-container { height: 300px; }
    #question-accuracy-list { max-height: 400px; }
    .pagination-controls .page-info { order: -1; flex-basis: 100%; margin-bottom: var(--spacing-sm); }

    /* Settings & Prompt Guide Mobile */
    #settings-screen .setting-item,
    #prompt-guide-screen .prompt-customization-fields .setting-item,
    #prompt-guide-screen .settings-group .setting-item { /* For JSON generate section in prompt guide */
        grid-template-columns: 1fr;
        gap: var(--spacing-xs);
    }
    #settings-screen .setting-item > label:not(.checkbox-label),
    #prompt-guide-screen .prompt-customization-fields .setting-item > label,
    #prompt-guide-screen .settings-group .setting-item > label { /* For JSON generate section in prompt guide */
        text-align: left; padding-top: 0; padding-right: 0;
    }
    #settings-screen .setting-item .setting-input,
    #settings-screen .setting-item .setting-select,
    #settings-screen .setting-item textarea,
    #prompt-guide-screen .prompt-customization-fields input,
    #prompt-guide-screen .settings-group textarea { /* For JSON generate section in prompt guide */
        max-width: none;
    }
    #settings-screen .setting-item.button-item,
    #prompt-guide-screen .settings-group .setting-item.button-item { /* For JSON generate button if it were styled this way */
        grid-template-columns: 1fr; text-align: left;
    }
    #settings-screen .setting-item.button-item .button,
    #settings-screen .setting-item.button-item .file-label,
    #settings-screen .setting-item.button-item .note,
    #settings-screen .setting-item.button-item .setting-status,
    #prompt-guide-screen .settings-group .setting-item .button, /* For JSON generate button */
    #prompt-guide-screen .settings-group .setting-item .note,   /* For JSON generate note */
    #prompt-guide-screen .settings-group .setting-item .status-message { /* For JSON generate status */
        grid-column: 1 / -1; justify-self: stretch; margin-left: 0;
    }
     #settings-screen .setting-item.button-item .note,
     #settings-screen .setting-item.button-item .setting-status,
     #prompt-guide-screen .settings-group .setting-item .note,
     #prompt-guide-screen .settings-group .setting-item .status-message {
         margin-top: var(--spacing-xs);
    }
    #settings-screen .setting-item.danger-zone { padding: var(--spacing-md); }

}

@media (max-width: 480px) { /* Phones */
    html { font-size: 14px; }
    .button { min-height: 40px; padding: var(--spacing-xs) var(--spacing-sm); }
    .app-header .app-title { font-size: 1rem; }
    .card { padding: var(--spacing-sm); }
    .card-header { padding: var(--spacing-xs) var(--spacing-sm); margin-left: calc(-1 * var(--spacing-sm)); margin-right: calc(-1 * var(--spacing-sm)); font-size: 1.1rem; }
    #app-container { padding: var(--spacing-xs); }
    .screen-title { font-size: 1.3rem; }

    /* Home Screen Phone */
    #deck-list-controls { padding: var(--spacing-xs); flex-direction: column; }
    #deck-list-controls input[type="search"],
    #deck-list-controls select { width: 100%; max-width: none; font-size: 0.9rem; }

    /* Study Screen Phone */
    #study-screen { padding-bottom: calc(var(--bottom-nav-height) + 80px); }
    #study-screen h2 { font-size: 1.3em; margin-bottom: var(--spacing-md); }
    #question-text { font-size: 1.15rem; }
    #feedback-message { font-size: 1.1rem; padding: var(--spacing-xs) var(--spacing-sm); }
    .eval-button { font-size: 0.9rem; min-width: auto; flex-basis: calc(33.33% - var(--spacing-sm) * 2/3); }
    .eval-buttons-container { gap: var(--spacing-sm); }

    /* Dashboard Phone */
    .question-accuracy-item { padding: var(--spacing-sm); flex-direction: column; align-items: stretch; gap: var(--spacing-sm); }
    .question-accuracy-item .question-text-preview { white-space: normal; }
    .question-accuracy-item .score-container { width: 100%; justify-content: space-between; margin-top: var(--spacing-xs); }
    .pagination-controls .button { padding: var(--spacing-sm); }
    .chart-container { height: 250px; }

    /* Prompt Guide Phone */
     .prompt-customization-fields { padding: var(--spacing-md); }
     #prompt-guide-screen .json-check-area textarea,
     #prompt-guide-screen .settings-group textarea#plain-json-input {
         min-height: 100px;
    }


    /* Global Notification Phone */
    #global-notification {
         max-width: calc(100% - (var(--spacing-md) * 2));
         padding: var(--spacing-sm) var(--spacing-md);
         bottom: -120px;
    }
     #global-notification[aria-hidden="false"] {
        bottom: calc(var(--bottom-nav-height) + var(--spacing-sm));
    }
     #notification-message { font-size: 0.9rem; }
     #notification-close-button { font-size: 1.2rem; }
}
